---
tasks:
  centos7:
    shell_commands:
      - sed -i.bak -e 's/^# android_sdk_repository/android_sdk_repository/' -e 's/^#
        android_ndk_repository/android_ndk_repository/' WORKSPACE
      - rm -f WORKSPACE.bak
    build_targets:
      - "//src:bazel"
      - "//src:bazel_jdk_minimal"
    test_flags:
      - "--test_timeout=1200"
    test_targets:
      - "--"
      - "//src/test/java/com/google/devtools/build/lib:exec-tests"
      - "//src/test/shell/bazel:help_test"
      - "//src/test/shell/bazel:cc_integration_test"
      - "//src/test/py/bazel:first_time_use_test"
    include_json_profile:
      - build
      - test
  debian10:
    shell_commands:
      - sed -i.bak -e 's/^# android_sdk_repository/android_sdk_repository/' -e 's/^#
        android_ndk_repository/android_ndk_repository/' WORKSPACE
      - rm -f WORKSPACE.bak
    build_targets:
      - "//src:bazel"
      - "//src:bazel_jdk_minimal"
    test_flags:
      - "--test_timeout=1200"
    test_targets:
      - "--"
      - "//src/test/java/com/google/devtools/build/lib:exec-tests"
      - "//src/test/shell/bazel:help_test"
      - "//src/test/shell/bazel:cc_integration_test"
      - "//src/test/py/bazel:first_time_use_test"
    include_json_profile:
      - build
      - test
  ubuntu1604:
    shell_commands:
      - sed -i.bak -e 's/^# android_sdk_repository/android_sdk_repository/' -e 's/^#
        android_ndk_repository/android_ndk_repository/' WORKSPACE
      - rm -f WORKSPACE.bak
    build_targets:
      - "//src:bazel"
      - "//src:bazel_jdk_minimal"
    test_flags:
      - "--test_timeout=1200"
    test_targets:
      - "--"
      - "//src/test/java/com/google/devtools/build/lib:exec-tests"
      - "//src/test/shell/bazel:help_test"
      - "//src/test/shell/bazel:cc_integration_test"
      - "//src/test/py/bazel:first_time_use_test"
    include_json_profile:
      - build
      - test
  ubuntu1804:
    shell_commands:
      - sed -i.bak -e 's/^# android_sdk_repository/android_sdk_repository/' -e 's/^#
        android_ndk_repository/android_ndk_repository/' WORKSPACE
      - rm -f WORKSPACE.bak
    build_targets:
      - "//src:bazel"
      - "//src:bazel_jdk_minimal"
    test_flags:
      - "--test_timeout=1200"
    test_targets:
      - "--"
      - "//src/test/java/com/google/devtools/build/lib:exec-tests"
      - "//src/test/shell/bazel:help_test"
      - "//src/test/shell/bazel:cc_integration_test"
      - "//src/test/py/bazel:first_time_use_test"
    include_json_profile:
      - build
      - test
  ubuntu1804_clang:
    platform: ubuntu1804
    environment:
      CC: clang
      CC_CONFIGURE_DEBUG: 1
    name: "Clang"
    shell_commands:
      - sed -i.bak -e 's/^# android_sdk_repository/android_sdk_repository/' -e 's/^#
        android_ndk_repository/android_ndk_repository/' WORKSPACE
      - rm -f WORKSPACE.bak
    build_targets:
      - "//src:bazel"
      - "//src:bazel_jdk_minimal"
    test_flags:
      - "--test_timeout=1200"
    test_targets:
      - "--"
      - "//src/test/java/com/google/devtools/build/lib:exec-tests"
      - "//src/test/py/bazel:first_time_use_test"
      - "//src/test/shell/bazel:cc_integration_test"
      - "//src/test/shell/bazel:help_test"
    include_json_profile:
      - build
      - test
  macos:
    shell_commands:
      - sed -i.bak -e 's/^# android_sdk_repository/android_sdk_repository/' -e 's/^#
        android_ndk_repository/android_ndk_repository/' WORKSPACE
      - rm -f WORKSPACE.bak
    build_flags:
      - "--apple_platform_type=macos"
    build_targets:
      - "//src:bazel"
      - "//src:bazel_jdk_minimal"
    test_flags:
      - "--test_timeout=1200"
    test_targets:
      - "--"
      - "//src/test/java/com/google/devtools/build/lib:exec-tests"
      - "//src/test/shell/bazel:help_test"
      - "//src/test/shell/bazel:cc_integration_test"
      - "//src/test/py/bazel:first_time_use_test"
    include_json_profile:
      - build
      - test
  windows:
    batch_commands:
      - powershell -Command "(Get-Content WORKSPACE) -Replace '# android_', 'android_' | Set-Content WORKSPACE"
    build_flags:
      - "--copt=-w"
      - "--host_copt=-w"
    build_targets:
      - "//src:bazel"
      - "//src:bazel_jdk_minimal"
    test_flags:
      - "--copt=-w"
      - "--host_copt=-w"
      - "--test_env=JAVA_HOME"
      - "--test_timeout=1200"
    test_targets:
      - "--"
      - "//src/test/java/com/google/devtools/build/lib:exec-tests"
      - "//src/test/shell/bazel:help_test"
      - "//src/test/shell/bazel:cc_integration_test"
      - "//src/test/py/bazel:first_time_use_test"
    include_json_profile:
      - build
      - test
  rbe_ubuntu1604:
    shell_commands:
      - sed -i.bak -e 's/^# android_sdk_repository/android_sdk_repository/' -e 's/^#
        android_ndk_repository/android_ndk_repository/' WORKSPACE
      - rm -f WORKSPACE.bak
    build_flags:
      - "--config=ubuntu1604_java8"
      - "--remote_executor=grpcs://remotebuildexecution.googleapis.com"
      - "--jobs=200"
      - "--experimental_remote_download_outputs=minimal"
      - "--experimental_inmemory_jdeps_files"
      - "--experimental_inmemory_dotd_files"
    build_targets:
      - "//src:bazel"
      - "//src:bazel_jdk_minimal"
    test_flags:
      - "--config=ubuntu1604_java8"
      - "--remote_executor=grpcs://remotebuildexecution.googleapis.com"
      - "--jobs=200"
      - "--experimental_remote_download_outputs=minimal"
      - "--experimental_inmemory_jdeps_files"
      - "--experimental_inmemory_dotd_files"
    test_targets:
      - "--"
      - "//src/test/java/com/google/devtools/build/lib:exec-tests"
      - "//src/test/shell/bazel:help_test"
      - "//src/test/shell/integration:cpp_test"
      - "//src/test/py/bazel:first_time_use_test"
    include_json_profile:
      - build
      - test
